import{d as k,r as h,c as f,o as q,a as B,b as m,w as a,u as n,I as E,e as l,f as N,g as F,h as _,i as L,j as T,k as w,l as S,m as V,n as i,t as s,p as A,q as D,s as H,F as R,v as $,x as j,y as c,z,A as M}from"./index-BAKnMHDu.js";import{q as P,o as U,c as I,a as g,d as x}from"./firebase-CA3CGHmd.js";const O=k({__name:"ExpenseList",setup(G){const b=j(),u=h([]);let r=null;const y=t=>{b.push("/edit/".concat(t))},C=f(()=>u.value.filter(t=>t.type==="income").reduce((t,e)=>t+(Number(e.amount)||0),0)),v=f(()=>u.value.filter(t=>t.type==="expense").reduce((t,e)=>t+(Number(e.amount)||0),0));return q(()=>{const t=P(I(x,"expenses"),U("createdAt","desc"));r=g(t,e=>{console.log("Docs found:",e.docs.length),u.value=e.docs.map(o=>{const d=o.data();return{id:o.id,...d}})},e=>{if(console.error("Firebase Snapshot Error:",e),e.code==="failed-precondition"){console.log("Retrying without sort (potential missing index)");const o=I(x,"expenses");r=g(o,d=>{u.value=d.docs.map(p=>({id:p.id,...p.data()}))})}})}),B(()=>{r&&r()}),(t,e)=>(c(),m(n(E),null,{default:a(()=>[l(n(L),null,{default:a(()=>[l(n(N),null,{default:a(()=>[l(n(F),null,{default:a(()=>[...e[0]||(e[0]=[_("รายการรายรับ–รายจ่าย",-1)])]),_:1})]),_:1})]),_:1}),l(n($),{class:"ion-padding"},{default:a(()=>[l(n(T),null,{default:a(()=>[l(n(w),null,{default:a(()=>[l(n(S),null,{default:a(()=>[...e[1]||(e[1]=[_("สรุป",-1)])]),_:1})]),_:1}),l(n(V),null,{default:a(()=>[i("p",null,"รวมรายรับ: "+s(C.value)+" บาท",1),i("p",null,"รวมรายจ่าย: "+s(v.value)+" บาท",1)]),_:1})]),_:1}),l(n(A),null,{default:a(()=>[(c(!0),D(R,null,H(u.value,o=>(c(),m(n(z),{key:o.id,button:"",onClick:d=>y(o.id)},{default:a(()=>[l(n(M),null,{default:a(()=>[i("h2",null,s(o.title)+" ("+s(o.type)+")",1),i("p",null,s(o.category)+" • "+s(o.amount)+" บาท",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}))}});export{O as default};
